{"ast":null,"code":"import _regeneratorRuntime from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{deleteDataAPI,patchDataAPI,postDataAPI}from\"../../utils/fetchData\";import{NOTIFY_TYPES}from\"../types/notifyTypes\";import{POST_TYPES}from\"../types/postTypes\";import{deleteData,editData}from\"../types/globalTypes\";import{createNewsNotify,removeNewsNotify}from\"./newsActions\";import{POSTMODAL_TYPES}from\"../types/postModalTypes\";export var createCommentAction=function createCommentAction(_ref){var post=_ref.post,newComment=_ref.newComment,auth=_ref.auth,socket=_ref.socket,postModal=_ref.postModal;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var newPost,data,res,newData,_newPost,msg;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:newPost=_objectSpread(_objectSpread({},post),{},{comments:[].concat(_toConsumableArray(post.comments),[newComment])});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});_context.prev=2;data=_objectSpread(_objectSpread({},newComment),{},{postId:post._id,postUserId:post.user._id});_context.next=6;return postDataAPI(\"comment\",data,auth.token);case 6:res=_context.sent;newData=_objectSpread(_objectSpread({},res.data.newComment),{},{user:auth.user});_newPost=_objectSpread(_objectSpread({},post),{},{comments:[].concat(_toConsumableArray(post.comments),[newData])});dispatch({type:POST_TYPES.UPDATE_POST,payload:_newPost});if(postModal!==false)dispatch({type:POSTMODAL_TYPES.ISMODAL,payload:_newPost});socket.emit(\"createComment\",_newPost);// Notify\nmsg={id:res.data.newComment._id,text:newComment.reply?\"mentioned you in a comment.\":\"has commented on your post.\",recipients:newComment.reply?[newComment.tag._id]:[post.user._id],url:\"/post/\".concat(post._id),content:post.content,image:post.images[0].url};dispatch(createNewsNotify({msg:msg,auth:auth,socket:socket}));_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](2);dispatch({type:NOTIFY_TYPES.NOTIFY,payload:{error:_context.t0.response.data.msg}});case 19:case\"end\":return _context.stop();}}},_callee,null,[[2,16]]);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var updateCommentAction=function updateCommentAction(_ref3){var comment=_ref3.comment,post=_ref3.post,content=_ref3.content,auth=_ref3.auth;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var newComments,newPost;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:newComments=editData(post.comments,comment._id,_objectSpread(_objectSpread({},comment),{},{content:content}));newPost=_objectSpread(_objectSpread({},post),{},{comments:newComments});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});_context2.prev=3;_context2.next=6;return patchDataAPI(\"comment/\".concat(comment._id),{content:content},auth.token);case 6:_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](3);dispatch({type:NOTIFY_TYPES.NOTIFY,payload:{error:_context2.t0.response.data.msg}});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[3,8]]);}));return function(_x2){return _ref4.apply(this,arguments);};}();};export var likeCommentAction=function likeCommentAction(_ref5){var comment=_ref5.comment,post=_ref5.post,auth=_ref5.auth,postModal=_ref5.postModal;return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var newComment,newComments,newPost;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:newComment=_objectSpread(_objectSpread({},comment),{},{likes:[].concat(_toConsumableArray(comment.likes),[auth.user])});newComments=editData(post.comments,comment._id,newComment);newPost=_objectSpread(_objectSpread({},post),{},{comments:newComments});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});if(postModal!==false)dispatch({type:POSTMODAL_TYPES.ISMODAL,payload:newPost});_context3.prev=5;_context3.next=8;return patchDataAPI(\"comment/\".concat(comment._id,\"/like\"),null,auth.token);case 8:_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](5);dispatch({type:NOTIFY_TYPES.NOTIFY,payload:{error:_context3.t0.response.data.msg}});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[5,10]]);}));return function(_x3){return _ref6.apply(this,arguments);};}();};export var unLikeCommentAction=function unLikeCommentAction(_ref7){var comment=_ref7.comment,post=_ref7.post,auth=_ref7.auth,postModal=_ref7.postModal;return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var newComment,newComments,newPost;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:newComment=_objectSpread(_objectSpread({},comment),{},{likes:deleteData(comment.likes,auth.user._id)});newComments=editData(post.comments,comment._id,newComment);newPost=_objectSpread(_objectSpread({},post),{},{comments:newComments});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});if(postModal!==false)dispatch({type:POSTMODAL_TYPES.ISMODAL,payload:newPost});_context4.prev=5;_context4.next=8;return patchDataAPI(\"comment/\".concat(comment._id,\"/unlike\"),null,auth.token);case 8:_context4.next=13;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](5);dispatch({type:NOTIFY_TYPES.NOTIFY,payload:{error:_context4.t0.response.data.msg}});case 13:case\"end\":return _context4.stop();}}},_callee4,null,[[5,10]]);}));return function(_x4){return _ref8.apply(this,arguments);};}();};export var deleteCommentAction=function deleteCommentAction(_ref9){var post=_ref9.post,auth=_ref9.auth,comment=_ref9.comment,socket=_ref9.socket,postModal=_ref9.postModal;return/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch){var deleteArr,newPost;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:deleteArr=[].concat(_toConsumableArray(post.comments.filter(function(cm){return cm.reply===comment._id;})),[comment]);newPost=_objectSpread(_objectSpread({},post),{},{comments:post.comments.filter(function(cm){return!deleteArr.find(function(da){return cm._id===da._id;});})});dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});if(postModal!==false)dispatch({type:POSTMODAL_TYPES.ISMODAL,payload:newPost});socket.emit(\"deleteComment\",newPost);try{deleteArr.forEach(/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(item){var msg;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return deleteDataAPI(\"comment/\".concat(item._id),auth.token);case 2:// Notify\nmsg={id:item._id,text:comment.reply?\"mentioned you in a comment.\":\"has commented on your post.\",recipients:comment.reply?[comment.tag._id]:[post.user._id],url:\"/post/\".concat(post._id)};dispatch(removeNewsNotify({msg:msg,auth:auth,socket:socket}));case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x6){return _ref11.apply(this,arguments);};}());}catch(err){dispatch({type:NOTIFY_TYPES.NOTIFY,payload:{error:err.response.data.msg}});}case 6:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x5){return _ref10.apply(this,arguments);};}();};","map":{"version":3,"sources":["C:/Benkia/MERN/instagram-clone/client/src/redux/actions/commentActions.js"],"names":["deleteDataAPI","patchDataAPI","postDataAPI","NOTIFY_TYPES","POST_TYPES","deleteData","editData","createNewsNotify","removeNewsNotify","POSTMODAL_TYPES","createCommentAction","post","newComment","auth","socket","postModal","dispatch","newPost","comments","type","UPDATE_POST","payload","data","postId","_id","postUserId","user","token","res","newData","ISMODAL","emit","msg","id","text","reply","recipients","tag","url","content","image","images","NOTIFY","error","response","updateCommentAction","comment","newComments","likeCommentAction","likes","unLikeCommentAction","deleteCommentAction","deleteArr","filter","cm","find","da","forEach","item","err"],"mappings":"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","sourcesContent":["import {\r\n  deleteDataAPI,\r\n  patchDataAPI,\r\n  postDataAPI,\r\n} from \"../../utils/fetchData\";\r\nimport { NOTIFY_TYPES } from \"../types/notifyTypes\";\r\nimport { POST_TYPES } from \"../types/postTypes\";\r\nimport { deleteData, editData } from \"../types/globalTypes\";\r\nimport { createNewsNotify, removeNewsNotify } from \"./newsActions\";\r\nimport { POSTMODAL_TYPES } from \"../types/postModalTypes\";\r\nexport const createCommentAction = ({\r\n  post,\r\n  newComment,\r\n  auth,\r\n  socket,\r\n  postModal,\r\n}) => {\r\n  return async (dispatch) => {\r\n    const newPost = { ...post, comments: [...post.comments, newComment] };\r\n    dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n\r\n    try {\r\n      const data = {\r\n        ...newComment,\r\n        postId: post._id,\r\n        postUserId: post.user._id,\r\n      };\r\n      const res = await postDataAPI(\"comment\", data, auth.token);\r\n\r\n      const newData = { ...res.data.newComment, user: auth.user };\r\n      const newPost = { ...post, comments: [...post.comments, newData] };\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n\r\n      if (postModal !== false)\r\n        dispatch({ type: POSTMODAL_TYPES.ISMODAL, payload: newPost });\r\n\r\n      socket.emit(\"createComment\", newPost);\r\n\r\n      // Notify\r\n      const msg = {\r\n        id: res.data.newComment._id,\r\n        text: newComment.reply\r\n          ? \"mentioned you in a comment.\"\r\n          : \"has commented on your post.\",\r\n        recipients: newComment.reply ? [newComment.tag._id] : [post.user._id],\r\n        url: `/post/${post._id}`,\r\n        content: post.content,\r\n        image: post.images[0].url,\r\n      };\r\n\r\n      dispatch(createNewsNotify({ msg, auth, socket }));\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const updateCommentAction = ({ comment, post, content, auth }) => {\r\n  return async (dispatch) => {\r\n    const newComments = editData(post.comments, comment._id, {\r\n      ...comment,\r\n      content,\r\n    });\r\n\r\n    const newPost = { ...post, comments: newComments };\r\n\r\n    dispatch({\r\n      type: POST_TYPES.UPDATE_POST,\r\n      payload: newPost,\r\n    });\r\n\r\n    try {\r\n      await patchDataAPI(`comment/${comment._id}`, { content }, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const likeCommentAction = ({ comment, post, auth, postModal }) => {\r\n  return async (dispatch) => {\r\n    const newComment = { ...comment, likes: [...comment.likes, auth.user] };\r\n    const newComments = editData(post.comments, comment._id, newComment);\r\n    const newPost = { ...post, comments: newComments };\r\n\r\n    dispatch({\r\n      type: POST_TYPES.UPDATE_POST,\r\n      payload: newPost,\r\n    });\r\n\r\n    if (postModal !== false)\r\n      dispatch({ type: POSTMODAL_TYPES.ISMODAL, payload: newPost });\r\n\r\n    try {\r\n      await patchDataAPI(`comment/${comment._id}/like`, null, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const unLikeCommentAction = ({ comment, post, auth, postModal }) => {\r\n  return async (dispatch) => {\r\n    const newComment = {\r\n      ...comment,\r\n      likes: deleteData(comment.likes, auth.user._id),\r\n    };\r\n    const newComments = editData(post.comments, comment._id, newComment);\r\n    const newPost = { ...post, comments: newComments };\r\n\r\n    dispatch({\r\n      type: POST_TYPES.UPDATE_POST,\r\n      payload: newPost,\r\n    });\r\n\r\n    if (postModal !== false)\r\n      dispatch({ type: POSTMODAL_TYPES.ISMODAL, payload: newPost });\r\n\r\n    try {\r\n      await patchDataAPI(`comment/${comment._id}/unlike`, null, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const deleteCommentAction = ({\r\n  post,\r\n  auth,\r\n  comment,\r\n  socket,\r\n  postModal,\r\n}) => {\r\n  return async (dispatch) => {\r\n    const deleteArr = [\r\n      ...post.comments.filter((cm) => cm.reply === comment._id),\r\n      comment,\r\n    ];\r\n\r\n    const newPost = {\r\n      ...post,\r\n      comments: post.comments.filter(\r\n        (cm) => !deleteArr.find((da) => cm._id === da._id)\r\n      ),\r\n    };\r\n\r\n    dispatch({\r\n      type: POST_TYPES.UPDATE_POST,\r\n      payload: newPost,\r\n    });\r\n\r\n    if (postModal !== false)\r\n      dispatch({ type: POSTMODAL_TYPES.ISMODAL, payload: newPost });\r\n\r\n    socket.emit(\"deleteComment\", newPost);\r\n    try {\r\n      deleteArr.forEach(async (item) => {\r\n        await deleteDataAPI(`comment/${item._id}`, auth.token);\r\n\r\n        // Notify\r\n        const msg = {\r\n          id: item._id,\r\n          text: comment.reply\r\n            ? \"mentioned you in a comment.\"\r\n            : \"has commented on your post.\",\r\n          recipients: comment.reply ? [comment.tag._id] : [post.user._id],\r\n          url: `/post/${post._id}`,\r\n        };\r\n\r\n        dispatch(removeNewsNotify({ msg, auth, socket }));\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}