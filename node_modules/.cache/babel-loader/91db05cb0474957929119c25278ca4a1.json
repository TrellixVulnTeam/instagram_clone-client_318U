{"ast":null,"code":"import _regeneratorRuntime from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import LoadMoreBtn from\"../../components/LoadMoreBtn\";import CardBody from\"../../components/PostCards/CardBody\";import CardFooter from\"../../components/PostCards/CardFooter\";import CardHeader from\"../../components/PostCards/CardHeader\";import LoadingIcon from\"../../assets/images/loading.gif\";import\"./index.scss\";import{getDataAPI}from\"../../utils/fetchData\";import{POST_TYPES}from\"../../redux/types/postTypes\";import{getMorePosts}from\"../../redux/actions/postActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Posts=function Posts(){var _useSelector=useSelector(function(state){return state;}),homePosts=_useSelector.homePosts,auth=_useSelector.auth;var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),load=_useState2[0],setLoad=_useState2[1];var pageEnd=useRef();var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),page=_useState4[0],setPage=_useState4[1];var handleLoadMore=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoad(true);_context.next=3;return getDataAPI(\"posts?limit=\".concat(homePosts.page*9),auth.token);case 3:res=_context.sent;dispatch({type:POST_TYPES.GET_POSTS,payload:_objectSpread(_objectSpread({},res.data),{},{page:homePosts.page+1})});setLoad(false);case 6:case\"end\":return _context.stop();}}},_callee);}));return function handleLoadMore(){return _ref.apply(this,arguments);};}();//Load more\nuseEffect(function(){var observer=new IntersectionObserver(function(entries){if(entries[0].isIntersecting){setPage(function(p){return p+1;});}},{threshold:0.1});observer.observe(pageEnd.current);},[setPage]);useEffect(function(){if(homePosts.result>=9*(page-1)&&page>1){setLoad(true);dispatch(getMorePosts({auth:auth,page:page}));setLoad(false);}else{return;}},[auth,dispatch,homePosts.result,page]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"posts-container\",children:[homePosts.posts.map(function(post,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"posts-content\",children:[/*#__PURE__*/_jsx(CardHeader,{post:post,handleCheck:true}),/*#__PURE__*/_jsx(CardBody,{post:post}),/*#__PURE__*/_jsx(CardFooter,{post:post,handleCheck:true})]},post._id);}),load&&/*#__PURE__*/_jsx(\"div\",{className:\"posts-loading\",children:/*#__PURE__*/_jsx(\"img\",{src:LoadingIcon,alt:\"Logo\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"posts-loadMore\",ref:pageEnd,children:\"LoadMore\"})]})});};export default Posts;","map":{"version":3,"sources":["C:/Benkia/MERN/instagram-clone/client/src/layouts/Posts/index.js"],"names":["React","useEffect","useRef","useState","useDispatch","useSelector","LoadMoreBtn","CardBody","CardFooter","CardHeader","LoadingIcon","getDataAPI","POST_TYPES","getMorePosts","Posts","state","homePosts","auth","dispatch","load","setLoad","pageEnd","page","setPage","handleLoadMore","token","res","type","GET_POSTS","payload","data","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","current","result","posts","map","post","index","_id"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport LoadMoreBtn from \"../../components/LoadMoreBtn\";\r\nimport CardBody from \"../../components/PostCards/CardBody\";\r\nimport CardFooter from \"../../components/PostCards/CardFooter\";\r\nimport CardHeader from \"../../components/PostCards/CardHeader\";\r\nimport LoadingIcon from \"../../assets/images/loading.gif\";\r\nimport \"./index.scss\";\r\nimport { getDataAPI } from \"../../utils/fetchData\";\r\nimport { POST_TYPES } from \"../../redux/types/postTypes\";\r\nimport { getMorePosts } from \"../../redux/actions/postActions\";\r\nconst Posts = () => {\r\n  const { homePosts, auth } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n  const [load, setLoad] = useState(false);\r\n\r\n  const pageEnd = useRef();\r\n  const [page, setPage] = useState(1);\r\n\r\n  const handleLoadMore = async () => {\r\n    setLoad(true);\r\n    const res = await getDataAPI(\r\n      `posts?limit=${homePosts.page * 9}`,\r\n      auth.token\r\n    );\r\n    dispatch({\r\n      type: POST_TYPES.GET_POSTS,\r\n      payload: { ...res.data, page: homePosts.page + 1 },\r\n    });\r\n    setLoad(false);\r\n  };\r\n\r\n  //Load more\r\n\r\n  useEffect(() => {\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        if (entries[0].isIntersecting) {\r\n          setPage((p) => p + 1);\r\n        }\r\n      },\r\n      {\r\n        threshold: 0.1,\r\n      }\r\n    );\r\n\r\n    observer.observe(pageEnd.current);\r\n  }, [setPage]);\r\n\r\n  useEffect(() => {\r\n    if (homePosts.result >= 9 * (page - 1) && page > 1) {\r\n      setLoad(true);\r\n      dispatch(getMorePosts({ auth, page }));\r\n      setLoad(false);\r\n    } else {\r\n      return;\r\n    }\r\n  }, [auth, dispatch, homePosts.result, page]);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"posts-container\">\r\n        {homePosts.posts.map((post, index) => (\r\n          <div key={post._id} className=\"posts-content\">\r\n            <CardHeader post={post} handleCheck={true} />\r\n            <CardBody post={post} />\r\n            <CardFooter post={post} handleCheck={true} />\r\n          </div>\r\n        ))}\r\n\r\n        {load && (\r\n          <div className=\"posts-loading\">\r\n            <img src={LoadingIcon} alt=\"Logo\" />\r\n          </div>\r\n        )}\r\n\r\n        {/* <div className=\"discover-page-btn\">\r\n          <LoadMoreBtn\r\n            result={homePosts.result}\r\n            page={homePosts.page}\r\n            load={load}\r\n            handleLoadMore={handleLoadMore}\r\n          />\r\n        </div> */}\r\n        <button className=\"posts-loadMore\" ref={pageEnd}>\r\n          LoadMore\r\n        </button>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Posts;\r\n"]},"metadata":{},"sourceType":"module"}