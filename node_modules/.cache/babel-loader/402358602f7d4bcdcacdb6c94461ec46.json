{"ast":null,"code":"import { deleteDataAPI, getDataAPI, patchDataAPI, postDataAPI } from \"../../utils/fetchData\";\nimport { imageUpload } from \"../../utils/imageUpload\";\nimport { AUTH_TYPES } from \"../types/authTypes\";\nimport { NOTIFY_TYPES } from \"../types/notifyTypes\";\nimport { POST_TYPES } from \"../types/postTypes\";\nexport const createPostAction = ({\n  content,\n  images,\n  auth,\n  socket\n}) => {\n  return async dispatch => {\n    let media = [];\n\n    try {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          loading: true\n        }\n      });\n      if (images.length > 0) media = await imageUpload(images);\n      const res = await postDataAPI(\"posts\", {\n        content,\n        images: media\n      }, auth.token);\n      dispatch({\n        type: POST_TYPES.CREATE_POST,\n        payload: { ...res.data.newPost,\n          user: auth.user\n        }\n      });\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          loading: false\n        }\n      });\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const updatePostAction = ({\n  content,\n  images,\n  auth,\n  status\n}) => {\n  return async dispatch => {\n    let media = [];\n    const imgNewUrl = images.filter(img => !img.url);\n    const imgOldUrl = images.filter(img => img.url);\n    if (status.content === content && imgNewUrl.length === 0 && imgOldUrl.length === status.images.length) return;\n\n    try {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          loading: true\n        }\n      });\n      if (imgNewUrl.length > 0) media = await imageUpload(imgNewUrl);\n      const res = await patchDataAPI(`post/${status._id}`, {\n        content,\n        images: [...imgOldUrl, ...media]\n      }, auth.token);\n      dispatch({\n        type: POST_TYPES.UPDATE_POST,\n        payload: res.data.newPost\n      });\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          loading: false\n        }\n      });\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const getPosts = token => {\n  return async dispatch => {\n    try {\n      dispatch({\n        type: POST_TYPES.LOADING_POST,\n        payload: true\n      });\n      const res = await getDataAPI(\"posts\", token);\n      dispatch({\n        type: POST_TYPES.GET_POSTS,\n        payload: { ...res.data,\n          page: 2\n        }\n      });\n      dispatch({\n        type: POST_TYPES.LOADING_POST,\n        payload: false\n      });\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const likePostAction = ({\n  post,\n  auth,\n  socket\n}) => {\n  return async dispatch => {\n    const newPost = { ...post,\n      likes: [...post.likes, auth.user]\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    socket.emit(\"likePost\", newPost);\n\n    try {\n      const res = await patchDataAPI(`post/${post._id}/like`, null, auth.token);\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: res.data.msg\n      });\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const unLikePostAction = ({\n  post,\n  auth,\n  socket\n}) => {\n  return async dispatch => {\n    const newPost = { ...post,\n      likes: post.likes.filter(like => like._id !== auth.user._id)\n    };\n    dispatch({\n      type: POST_TYPES.UPDATE_POST,\n      payload: newPost\n    });\n    socket.emit(\"unLikePost\", newPost);\n\n    try {\n      const res = await patchDataAPI(`post/${post._id}/unlike`, null, auth.token);\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: res.data.msg\n      });\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const getPostDetail = ({\n  detailPost,\n  id,\n  auth\n}) => {\n  return async dispatch => {\n    if (detailPost.every(post => post._id !== id)) {\n      try {\n        const res = await getDataAPI(`post/${id}`, auth.token);\n        dispatch({\n          type: POST_TYPES.GET_POST,\n          payload: res.data.post\n        });\n      } catch (err) {\n        dispatch({\n          type: NOTIFY_TYPES.NOTIFY,\n          payload: {\n            error: err.response.data.msg\n          }\n        });\n      }\n    }\n  };\n};\nexport const deletePostAction = ({\n  post,\n  auth\n}) => {\n  return async dispatch => {\n    dispatch({\n      type: POST_TYPES.DELETE_POST,\n      payload: post\n    });\n\n    try {\n      await deleteDataAPI(`post/${post._id}`, auth.token);\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const savePostAction = ({\n  post,\n  auth\n}) => {\n  return async dispatch => {\n    const newUser = { ...auth.user,\n      saved: [...auth.user.saved, post._id]\n    };\n    dispatch({\n      type: AUTH_TYPES.AUTH,\n      payload: { ...auth,\n        user: newUser\n      }\n    });\n\n    try {\n      await patchDataAPI(`savePost/${post._id}`, null, auth.token);\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const unSavePostAction = ({\n  post,\n  auth\n}) => {\n  return async dispatch => {\n    console.log(123);\n    const newUser = { ...auth.user,\n      saved: auth.user.saved.filter(id => id !== post._id)\n    };\n    dispatch({\n      type: AUTH_TYPES.AUTH,\n      payload: { ...auth,\n        user: newUser\n      }\n    });\n\n    try {\n      await patchDataAPI(`unSavePost/${post._id}`, null, auth.token);\n    } catch (err) {\n      dispatch({\n        type: NOTIFY_TYPES.NOTIFY,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};","map":{"version":3,"sources":["C:/Benkia/MERN/instagram-clone/client/src/redux/actions/postActions.js"],"names":["deleteDataAPI","getDataAPI","patchDataAPI","postDataAPI","imageUpload","AUTH_TYPES","NOTIFY_TYPES","POST_TYPES","createPostAction","content","images","auth","socket","dispatch","media","type","NOTIFY","payload","loading","length","res","token","CREATE_POST","data","newPost","user","err","error","response","msg","updatePostAction","status","imgNewUrl","filter","img","url","imgOldUrl","_id","UPDATE_POST","getPosts","LOADING_POST","GET_POSTS","page","likePostAction","post","likes","emit","unLikePostAction","like","getPostDetail","detailPost","id","every","GET_POST","deletePostAction","DELETE_POST","savePostAction","newUser","saved","AUTH","unSavePostAction","console","log"],"mappings":"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","sourcesContent":["import {\r\n  deleteDataAPI,\r\n  getDataAPI,\r\n  patchDataAPI,\r\n  postDataAPI,\r\n} from \"../../utils/fetchData\";\r\nimport { imageUpload } from \"../../utils/imageUpload\";\r\nimport { AUTH_TYPES } from \"../types/authTypes\";\r\nimport { NOTIFY_TYPES } from \"../types/notifyTypes\";\r\nimport { POST_TYPES } from \"../types/postTypes\";\r\n\r\nexport const createPostAction = ({ content, images, auth,socket }) => {\r\n  return async (dispatch) => {\r\n    let media = [];\r\n    try {\r\n      dispatch({ type: NOTIFY_TYPES.NOTIFY, payload: { loading: true } });\r\n      if (images.length > 0) media = await imageUpload(images);\r\n\r\n      const res = await postDataAPI(\r\n        \"posts\",\r\n        { content, images: media },\r\n        auth.token\r\n      );\r\n      dispatch({\r\n        type: POST_TYPES.CREATE_POST,\r\n        payload: { ...res.data.newPost, user: auth.user },\r\n      });\r\n\r\n      dispatch({ type: NOTIFY_TYPES.NOTIFY, payload: { loading: false } });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const updatePostAction = ({ content, images, auth, status }) => {\r\n  return async (dispatch) => {\r\n    let media = [];\r\n    const imgNewUrl = images.filter((img) => !img.url);\r\n    const imgOldUrl = images.filter((img) => img.url);\r\n\r\n    if (\r\n      status.content === content &&\r\n      imgNewUrl.length === 0 &&\r\n      imgOldUrl.length === status.images.length\r\n    )\r\n      return;\r\n\r\n    try {\r\n      dispatch({ type: NOTIFY_TYPES.NOTIFY, payload: { loading: true } });\r\n      if (imgNewUrl.length > 0) media = await imageUpload(imgNewUrl);\r\n\r\n      const res = await patchDataAPI(\r\n        `post/${status._id}`,\r\n        {\r\n          content,\r\n          images: [...imgOldUrl, ...media],\r\n        },\r\n        auth.token\r\n      );\r\n\r\n      dispatch({\r\n        type: POST_TYPES.UPDATE_POST,\r\n        payload: res.data.newPost,\r\n      });\r\n\r\n      dispatch({ type: NOTIFY_TYPES.NOTIFY, payload: { loading: false } });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const getPosts = (token) => {\r\n  return async (dispatch) => {\r\n    try {\r\n      dispatch({ type: POST_TYPES.LOADING_POST, payload: true });\r\n      const res = await getDataAPI(\"posts\", token);\r\n      dispatch({\r\n        type: POST_TYPES.GET_POSTS,\r\n        payload: { ...res.data, page: 2 },\r\n      });\r\n      dispatch({ type: POST_TYPES.LOADING_POST, payload: false });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const likePostAction = ({ post, auth, socket }) => {\r\n  return async (dispatch) => {\r\n    const newPost = { ...post, likes: [...post.likes, auth.user] };\r\n    dispatch({\r\n      type: POST_TYPES.UPDATE_POST,\r\n      payload: newPost,\r\n    });\r\n\r\n    socket.emit(\"likePost\", newPost);\r\n    try {\r\n      const res = await patchDataAPI(`post/${post._id}/like`, null, auth.token);\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: res.data.msg,\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const unLikePostAction = ({ post, auth, socket }) => {\r\n  return async (dispatch) => {\r\n    const newPost = {\r\n      ...post,\r\n      likes: post.likes.filter((like) => like._id !== auth.user._id),\r\n    };\r\n\r\n    dispatch({\r\n      type: POST_TYPES.UPDATE_POST,\r\n      payload: newPost,\r\n    });\r\n    socket.emit(\"unLikePost\", newPost);\r\n\r\n    try {\r\n      const res = await patchDataAPI(\r\n        `post/${post._id}/unlike`,\r\n        null,\r\n        auth.token\r\n      );\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: res.data.msg,\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const getPostDetail = ({ detailPost, id, auth }) => {\r\n  return async (dispatch) => {\r\n    if (detailPost.every((post) => post._id !== id)) {\r\n      try {\r\n        const res = await getDataAPI(`post/${id}`, auth.token);\r\n        dispatch({\r\n          type: POST_TYPES.GET_POST,\r\n          payload: res.data.post,\r\n        });\r\n      } catch (err) {\r\n        dispatch({\r\n          type: NOTIFY_TYPES.NOTIFY,\r\n          payload: { error: err.response.data.msg },\r\n        });\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\nexport const deletePostAction = ({ post, auth }) => {\r\n  return async (dispatch) => {\r\n    dispatch({\r\n      type: POST_TYPES.DELETE_POST,\r\n      payload: post,\r\n    });\r\n\r\n    try {\r\n      await deleteDataAPI(`post/${post._id}`, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const savePostAction = ({ post, auth }) => {\r\n  return async (dispatch) => {\r\n    const newUser = { ...auth.user, saved: [...auth.user.saved, post._id] };\r\n    dispatch({\r\n      type: AUTH_TYPES.AUTH,\r\n      payload: { ...auth, user: newUser },\r\n    });\r\n\r\n    try {\r\n      await patchDataAPI(`savePost/${post._id}`, null, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const unSavePostAction = ({ post, auth }) => {\r\n  return async (dispatch) => {\r\n    console.log(123);\r\n    const newUser = {\r\n      ...auth.user,\r\n      saved: auth.user.saved.filter((id) => id !== post._id),\r\n    };\r\n\r\n    dispatch({\r\n      type: AUTH_TYPES.AUTH,\r\n      payload: { ...auth, user: newUser },\r\n    });\r\n\r\n    try {\r\n      await patchDataAPI(`unSavePost/${post._id}`, null, auth.token);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: NOTIFY_TYPES.NOTIFY,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}