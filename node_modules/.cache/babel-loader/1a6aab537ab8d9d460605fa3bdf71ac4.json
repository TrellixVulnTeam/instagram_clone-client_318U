{"ast":null,"code":"import _regeneratorRuntime from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Benkia/MERN/instagram-clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{getDiscoverPosts,getMorePostDiscover}from\"../../redux/actions/discoverActions\";import LoadingIcon from\"../../assets/images/loading.gif\";import\"./index.scss\";import PostThumb from\"../../components/PostProfile/PostThumb\";import LoadMoreBtn from\"../../components/LoadMoreBtn\";import{getDataAPI}from\"../../utils/fetchData\";import{DISCOVER_TYPES}from\"../../redux/types/discoverTypes\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DiscoverPage=function DiscoverPage(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,discover=_useSelector.discover;var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),load=_useState2[0],setLoad=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),page=_useState4[0],setPage=_useState4[1];var pageEnd=useRef();useEffect(function(){if(!discover.firstLoad){dispatch(getDiscoverPosts(auth.token));}},[dispatch,auth.token,discover.firstLoad]);var handleLoadMore=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoad(true);_context.next=3;return getDataAPI(\"post_discover?num=\".concat(discover.page*9),auth.token);case 3:res=_context.sent;dispatch({type:DISCOVER_TYPES.UPDATE_POST,payload:res.data});setLoad(false);case 6:case\"end\":return _context.stop();}}},_callee);}));return function handleLoadMore(){return _ref.apply(this,arguments);};}();//Loadmore\nuseEffect(function(){var observer=new IntersectionObserver(function(entries){if(entries[0].isIntersecting){setPage(function(p){return p+1;});}},{threshold:0.1});observer.observe(pageEnd.current);},[setPage]);useEffect(function(){if(discover.result>=9*(page-1)&&page>1){setLoad(true);dispatch(getMorePostDiscover({page:page,auth:auth}));setLoad(false);}else{return;}},[auth,dispatch,discover.result,page]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"discover-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"discover-page-container\",children:[discover.loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"discover-page-loading\",children:/*#__PURE__*/_jsx(\"img\",{src:LoadingIcon,alt:\"Logo\"})}),\" \"]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"discover-page-details\",children:/*#__PURE__*/_jsx(PostThumb,{posts:discover.posts,result:discover.result})})}),load&&/*#__PURE__*/_jsx(\"div\",{className:\"discover-page-loading\",children:/*#__PURE__*/_jsx(\"img\",{src:LoadingIcon,alt:\"Logo\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"discover-page-loadMore\",ref:pageEnd,children:\"Loadmore\"})]})})});};export default DiscoverPage;","map":{"version":3,"sources":["C:/Benkia/MERN/instagram-clone/client/src/pages/DiscoverPage/index.js"],"names":["React","useEffect","useRef","useState","useDispatch","useSelector","getDiscoverPosts","getMorePostDiscover","LoadingIcon","PostThumb","LoadMoreBtn","getDataAPI","DISCOVER_TYPES","DiscoverPage","state","auth","discover","dispatch","load","setLoad","page","setPage","pageEnd","firstLoad","token","handleLoadMore","res","type","UPDATE_POST","payload","data","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","current","result","loading","posts"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n  getDiscoverPosts,\r\n  getMorePostDiscover,\r\n} from \"../../redux/actions/discoverActions\";\r\nimport LoadingIcon from \"../../assets/images/loading.gif\";\r\nimport \"./index.scss\";\r\nimport PostThumb from \"../../components/PostProfile/PostThumb\";\r\nimport LoadMoreBtn from \"../../components/LoadMoreBtn\";\r\nimport { getDataAPI } from \"../../utils/fetchData\";\r\nimport { DISCOVER_TYPES } from \"../../redux/types/discoverTypes\";\r\nconst DiscoverPage = () => {\r\n  const { auth, discover } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n  const [load, setLoad] = useState(false);\r\n  const [page, setPage] = useState(0);\r\n  const pageEnd = useRef();\r\n\r\n  useEffect(() => {\r\n    if (!discover.firstLoad) {\r\n      dispatch(getDiscoverPosts(auth.token));\r\n    }\r\n  }, [dispatch, auth.token, discover.firstLoad]);\r\n\r\n  const handleLoadMore = async () => {\r\n    setLoad(true);\r\n    const res = await getDataAPI(\r\n      `post_discover?num=${discover.page * 9}`,\r\n      auth.token\r\n    );\r\n    dispatch({\r\n      type: DISCOVER_TYPES.UPDATE_POST,\r\n      payload: res.data,\r\n    });\r\n    setLoad(false);\r\n  };\r\n\r\n  //Loadmore\r\n\r\n  useEffect(() => {\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        if (entries[0].isIntersecting) {\r\n          setPage((p) => p + 1);\r\n        }\r\n      },\r\n      {\r\n        threshold: 0.1,\r\n      }\r\n    );\r\n\r\n    observer.observe(pageEnd.current);\r\n  }, [setPage]);\r\n\r\n  useEffect(() => {\r\n    if (discover.result >= 9 * (page - 1) && page > 1) {\r\n      setLoad(true);\r\n      dispatch(getMorePostDiscover({ page, auth }));\r\n      setLoad(false);\r\n    } else {\r\n      return;\r\n    }\r\n  }, [auth, dispatch, discover.result, page]);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"discover-page\">\r\n        <div className=\"discover-page-container\">\r\n          {discover.loading ? (\r\n            <>\r\n              <div className=\"discover-page-loading\">\r\n                <img src={LoadingIcon} alt=\"Logo\" />\r\n              </div>{\" \"}\r\n            </>\r\n          ) : (\r\n            <>\r\n              <div className=\"discover-page-details\">\r\n                <PostThumb posts={discover.posts} result={discover.result} />\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {load && (\r\n            <div className=\"discover-page-loading\">\r\n              <img src={LoadingIcon} alt=\"Logo\" />\r\n            </div>\r\n          )}\r\n          {/* <div className=\"discover-page-btn\">\r\n            {!discover.loading && (\r\n              <LoadMoreBtn\r\n                result={discover.result}\r\n                page={discover.page}\r\n                load={load}\r\n                handleLoadMore={handleLoadMore}\r\n              />\r\n            )}\r\n          </div> */}\r\n          <button className=\"discover-page-loadMore\" ref={pageEnd}>\r\n            Loadmore\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DiscoverPage;\r\n"]},"metadata":{},"sourceType":"module"}